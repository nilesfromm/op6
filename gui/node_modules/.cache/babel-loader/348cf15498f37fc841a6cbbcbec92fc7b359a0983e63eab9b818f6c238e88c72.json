{"ast":null,"code":"import{useEffect,useState,useRef}from\"react\";import{SpectrumAnalyzer}from\"./SpectrumAnalyzer\";import\"./index.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const SAMPLE_RATE=44100;const FREQUENCY_INTERVALS=[0,29,61,115,218,411,777,1500,2800,5200,11000];const FILTER_FREQS=FREQUENCY_INTERVALS.slice(2,10);const UI=_ref=>{let{amps,pans,handleSliderChange}=_ref;return/*#__PURE__*/_jsx(\"div\",{className:\"ui\",children:amps.map((amp,i)=>/*#__PURE__*/_jsxs(\"div\",{style:{position:\"relative\",left:\"\".concat(i/amps.length*76.8+21.75,\"%\")},children:[/*#__PURE__*/_jsx(\"input\",{className:\"freq-slider\",type:\"range\",value:amp,min:0.0,max:1.0,step:0.001,onChange:e=>handleSliderChange(\"amp\",i,e.target.value),onDoubleClick:()=>{handleSliderChange(\"amp\",i,1.0);}}),/*#__PURE__*/_jsx(\"input\",{className:\"pan-slider\",type:\"range\",min:-1.0,max:1.0,step:0.001,value:pans[i],onChange:e=>handleSliderChange(\"pan\",i,e.target.value),onDoubleClick:()=>{handleSliderChange(\"pan\",i,0.0);}})]},i))});};export default function View(_ref2){let{patchConnection}=_ref2;const[stateLoaded,setStateLoaded]=useState(false);const[fftData,setFFTData]=useState([]);const[amps,setAmps]=useState(Array(8).fill(0.0));const[pans,setPans]=useState(Array(8).fill(0.0));const updateValues=(type,index,value)=>{if(type===\"amp\"){setAmps(prev=>prev.map((amp,i)=>i===index?value:amp));}else if(type===\"pan\"){setPans(prev=>prev.map((pan,i)=>i===index?value:pan));}};const handleSliderChange=(type,index,value)=>{updateValues(type,index,value);patchConnection===null||patchConnection===void 0?void 0:patchConnection.sendEventOrValue(\"\".concat(type,\"Band\").concat(index),value,100);};const handleDftOut=event=>{setFFTData(event.magnitudes);};useEffect(()=>{const requestParameterValues=type=>{for(let i=0;i<FILTER_FREQS.length;i++){patchConnection===null||patchConnection===void 0?void 0:patchConnection.requestParameterValue(\"\".concat(type,\"Band\").concat(i));}};const handleControlChange=event=>{const id=event.endpointID;const val=event.value;const index=parseInt(id.slice(-1));const type=id.slice(0,3);updateValues(type,index,val);};// Add listeners for DFT output and input controls\npatchConnection===null||patchConnection===void 0?void 0:patchConnection.addEndpointListener(\"dftOut\",handleDftOut);patchConnection===null||patchConnection===void 0?void 0:patchConnection.addAllParameterListener(handleControlChange);// Load initial state\nif(!stateLoaded){requestParameterValues(\"amp\");requestParameterValues(\"pan\");setStateLoaded(true);}return()=>{patchConnection===null||patchConnection===void 0?void 0:patchConnection.removeEndpointListener(\"dftOut\",handleDftOut);patchConnection===null||patchConnection===void 0?void 0:patchConnection.removeAllParameterListener(handleControlChange);};},[patchConnection,stateLoaded]);return/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"stack\",children:[/*#__PURE__*/_jsx(SpectrumAnalyzer,{className:\"analyzer\",fftData:fftData// TODO: this should be sent from the backend\n,sampleRate:SAMPLE_RATE,frequencyIntervals:FREQUENCY_INTERVALS,filterFreqs:FILTER_FREQS,amps:amps}),/*#__PURE__*/_jsx(UI,{amps:amps,pans:pans,handleSliderChange:handleSliderChange})]})});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}