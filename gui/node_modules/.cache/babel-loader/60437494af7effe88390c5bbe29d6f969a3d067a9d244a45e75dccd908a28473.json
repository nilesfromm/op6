{"ast":null,"code":"import React,{SyntheticEvent,useState,useCallback,useEffect,useMemo}from\"react\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const BOTTOM_ANGLE_DEG=45;const RAD=Math.PI/180;const START_ANGLE=Math.PI*1.5-RAD*BOTTOM_ANGLE_DEG/2;const END_ANGLE=Math.PI*-0.5+RAD*BOTTOM_ANGLE_DEG/2;function getPointPair(r,angle,distance){return[r+distance*Math.cos(angle),r-distance*Math.sin(angle)];}function DialMask(_ref){let{id,size,startAngle,endAngle}=_ref;const r=size/2;const intermediatePoints=[0,0.25,0.5,0.75,1].map(fraction=>getPointPair(r,startAngle-(startAngle-endAngle)*fraction,r*4).join(\",\")).join(\" \");return/*#__PURE__*/_jsx(\"mask\",{id:id,children:/*#__PURE__*/_jsx(\"polygon\",{style:{fill:\"#fff\"},points:\"\".concat(r,\",\").concat(r,\" \").concat(intermediatePoints,\" \").concat(r,\",\").concat(r)})});}function getKnobValue(dragStart,currentY){let s=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;let bipolar=arguments.length>3?arguments[3]:undefined;const{y,value}=dragStart;const deltaY=y-currentY;const slope=0.01*s;let newValue=value+deltaY*slope;if(bipolar){const zeroCrossingResistance=0.3;if(value>=0&&newValue<0){newValue+=Math.min(zeroCrossingResistance,-newValue);}else if(value<0&&newValue>0){newValue-=Math.min(zeroCrossingResistance,newValue);}}// Clamp\nreturn Math.max(bipolar?-1:0,Math.min(1,newValue));}export default function Dial(_ref2){let{Id,bipolar=false,value=0,onChange,size=40,fillColor=\"#E0E0E0\",fillWidth=5,dotSize=2,min=20,max=1,scale=max-min}=_ref2;value=value/scale;// Clamp input value\nconst clamped=Math.max(bipolar?-1:0,Math.min(1,value));if(value!==clamped){value=clamped;onChange(\"t\",Id,min+clamped*scale);}const r=size/2;const uid=useMemo(()=>Dial.id++,[]);const zeroAngle=bipolar?Math.PI/2:START_ANGLE;const range=bipolar?(START_ANGLE-END_ANGLE)/2:START_ANGLE-END_ANGLE;const valueAngle=bipolar?Math.PI/2-value*range:START_ANGLE-value*range;const[dragStart,setDragStart]=useState(null);const isDragging=Boolean(dragStart);//-----MOUSE-------------------------------------------------------\nconst onMouseMove=useCallback(e=>{if(!dragStart)return;let speed=1;if(e.shiftKey){speed=0.1;}const newValue=getKnobValue(dragStart,e.clientY,speed,bipolar);onChange(\"freq\",Id,min+newValue*scale);},[dragStart,onChange,bipolar,scale]);const onMouseDown=useCallback(e=>{if(e.nativeEvent.button!==0)return;e.stopPropagation();setDragStart({value,y:e.nativeEvent.clientY});window.addEventListener(\"mousemove\",onMouseMove);},[setDragStart,onMouseMove,value]);const onMouseUp=useCallback(()=>{setDragStart(null);},[setDragStart]);useEffect(()=>{if(!isDragging){window.removeEventListener(\"mousemove\",onMouseMove);}window.addEventListener(\"mousemove\",onMouseMove);return()=>window.removeEventListener(\"mousemove\",onMouseMove);},[isDragging,onMouseMove]);useEffect(()=>{window.addEventListener(\"mouseup\",onMouseUp);return()=>{window.removeEventListener(\"mouseup\",onMouseUp);};},[onMouseUp]);useEffect(()=>{if(!onMouseMove)return;return()=>window.removeEventListener(\"mousemove\",onMouseMove);},[onMouseMove]);// //-----TOUCH-------------------------------------------------------\n// const onTouchMove = useCallback(\n//   (e: TouchEvent) => {\n//     if (!dragStart) return;\n//     let speed = 1;\n//     if (e.shiftKey){\n//       speed = 0.1;\n//     }\n//     // console.log(\"touchmove!\")\n//     const newValue = getKnobValue(dragStart, e.touches[0].clientY, speed, bipolar);\n//     onChange((newValue * scale));\n//   },\n//   [dragStart, onChange, bipolar, scale]\n// );\n// const onTouchDown = useCallback(\n//   (e: SyntheticEvent<Element, TouchEvent>) => {\n//     // if (e.nativeEvent.button !== 0) return;\n//     e.stopPropagation();\n//     setDragStart({ value, y: e.nativeEvent.touches[0].clientY });\n//     window.addEventListener(\"touchmove\", onTouchMove);\n//     // console.log(\"touchdown!\")\n//   },\n//   [setDragStart, onTouchMove, value]\n// );\n// const onTouchUp = useCallback(() => {\n//   setDragStart(null);\n//   // console.log(\"touchup!\")\n// }, [setDragStart]);\n// useEffect(() => {\n//   if (!isDragging) {\n//     window.removeEventListener(\"touchmove\", onTouchMove);\n//   }\n//   window.addEventListener(\"touchmove\", onTouchMove);\n//   return () => window.removeEventListener(\"touchmove\", onTouchMove);\n// }, [isDragging, onTouchMove]);\n// useEffect(() => {\n//   window.addEventListener(\"touchend\", onTouchUp);\n//   return () => {\n//     window.removeEventListener(\"touchend\", onTouchUp);\n//   };\n// }, [onTouchUp]);\n// useEffect(() => {\n//   if (!onTouchMove) return;\n//   return () => window.removeEventListener(\"touchmove\", onTouchMove);\n// }, [onTouchMove]);\nconst[dotX,dotY]=getPointPair(size/2,valueAngle,r-fillWidth-dotSize-2);return/*#__PURE__*/_jsxs(\"div\",{style:{position:\"relative\",cursor:\"ns-resize\",height:size,width:size,overflow:\"hidden\",flexShrink:0},onMouseDown:onMouseDown// onTouchStart={onTouchDown}\n,children:[/*#__PURE__*/_jsxs(\"svg\",{width:size,height:size,style:{position:\"absolute\",top:0,left:0,opacity:isDragging?1:0.7,fill:fillColor,filter:\"inner-shadow(0 2px 2px rgba(0, 0, 0, 0.9))\"// filter: isDragging ? \"brightness(200%)\" : undefined\n},children:[/*#__PURE__*/_jsx(\"defs\",{children:/*#__PURE__*/_jsxs(\"filter\",{id:\"innershadow\",width:\"200%\",height:\"200%\",children:[/*#__PURE__*/_jsx(\"feGaussianBlur\",{in:\"SourceAlpha\",stdDeviation:\"3\",result:\"blur\"}),/*#__PURE__*/_jsx(\"feOffset\",{dy:\"2\",dx:\"0\"}),/*#__PURE__*/_jsx(\"feComposite\",{in2:\"SourceAlpha\",operator:\"arithmetic\",k2:\"-1\",k3:\"1\",result:\"shadowDiff\"}),/*#__PURE__*/_jsx(\"feFlood\",{floodColor:\"#444444\",floodOpacity:\"0.25\"}),/*#__PURE__*/_jsx(\"feComposite\",{in2:\"shadowDiff\",operator:\"in\"}),/*#__PURE__*/_jsx(\"feComposite\",{in2:\"SourceGraphic\",operator:\"over\",result:\"firstfilter\"}),/*#__PURE__*/_jsx(\"feGaussianBlur\",{in:\"firstfilter\",stdDeviation:\"3\",result:\"blur2\"}),/*#__PURE__*/_jsx(\"feOffset\",{dy:\"-2\",dx:\"0\"}),/*#__PURE__*/_jsx(\"feComposite\",{in2:\"firstfilter\",operator:\"arithmetic\",k2:\"-1\",k3:\"1\",result:\"shadowDiff\"}),/*#__PURE__*/_jsx(\"feFlood\",{floodColor:\"#444444\",floodOpacity:\"0.25\"}),/*#__PURE__*/_jsx(\"feComposite\",{in2:\"shadowDiff\",operator:\"in\"}),/*#__PURE__*/_jsx(\"feComposite\",{in2:\"firstfilter\",operator:\"over\"})]})}),/*#__PURE__*/_jsx(\"circle\",{cx:size/2,cy:size/2,r:size/2,style:{mask:\"url(#value-track-mask-\".concat(uid,\")\"),fill:\"#E0E0E0\",filter:\"url(#innershadow)\"}})]}),/*#__PURE__*/_jsxs(\"svg\",{style:{position:\"absolute\",top:0,left:0,filter:\"drop-shadow(0 2px 2px rgba(0, 0, 0, 0.45))\"},children:[/*#__PURE__*/_jsx(\"circle\",{cx:r,cy:r,r:r-fillWidth,style:{fill:\"#F2F2F2\"}}),/*#__PURE__*/_jsx(\"circle\",{cx:r,cy:r,r:r-fillWidth,style:{fill:\"transparent\"},stroke:\"rgba(255, 255, 255, 0.2)\"})]}),/*#__PURE__*/_jsx(\"svg\",{style:{position:\"absolute\",top:0,left:0},children:/*#__PURE__*/_jsx(\"circle\",{cx:dotX,cy:dotY,r:dotSize,style:{fill:\"#FF7F50\"}})})]});}Dial.id=0;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}